var contract;
var account = null;
var web3;


var actionDesc;
//true for modal main
var modalDecision = true;

var startDate;

var dSModelName = null;

var bModelName = null;

var sStakePromise = null;

var cEnd = null;

var cAdd = null;

var contractAddress = "";
const bc = '0x6080604052600160045573a9187c8c9f692fe2ca6b80069e87df23b34157a3600860006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055506000600b557356dd6586db0d08c6ce7b2f2805af28616e082455601560006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055507f633132386662623031373534343263386261383238303430666464316132356560165567016345785d8a00006017557356dd6586db0d08c6ce7b2f2805af28616e082455601860006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055507f323634396663346361383363343031366266643264313537363535393262656560195567016345785d8a0000601a55601754600202601a5460030201601b553480156200018a57600080fd5b506040516200527f3803806200527f83398181016040526060811015620001b057600080fd5b8101908080516040519392919084640100000000821115620001d157600080fd5b83820191506020820185811115620001e857600080fd5b82518660018202830111640100000000821117156200020657600080fd5b8083526020830192505050908051906020019080838360005b838110156200023c5780820151818401526020810190506200021f565b50505050905090810190601f1680156200026a5780820380516001836020036101000a031916815260200191505b50604052602001805190602001909291908051906020019092919050505042601d81905550662386f26fc10000811015620002f1576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260448152602001806200523b6044913960600191505060405180910390fd5b6000601c60006101000a81548160ff02191690831515021790555081601e8190555082600990805190602001906200032b9291906200054d565b5080601f8190555033601360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550620003846200045f60201b60201c565b7f55e6d2419970dfeebb3bbe50864cfc7aad527644cb56e79760995944114d1f8b6009601e54601f546040518080602001848152602001838152602001828103825285818154600181600116156101000203166002900481526020019150805460018160011615610100020316600290048015620004465780601f106200041a5761010080835404028352916020019162000446565b820191906000526020600020905b8154815290600101906020018083116200042857829003601f168201915b505094505050505060405180910390a1505050620005f3565b6200050773c89bd4e1632d3a43cb03aaad5262cbe4038bc57173ffffffffffffffffffffffffffffffffffffffff166338cc48316040518163ffffffff1660e01b815260040160206040518083038186803b158015620004be57600080fd5b505afa158015620004d3573d6000803e3d6000fd5b505050506040513d6020811015620004ea57600080fd5b81019080805190602001909291905050506200050960201b60201c565b565b80600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200059057805160ff1916838001178555620005c1565b82800160010185558215620005c1579182015b82811115620005c0578251825591602001919060010190620005a3565b5b509050620005d09190620005d4565b5090565b5b80821115620005ef576000816000905550600101620005d5565b5090565b614c3880620006036000396000f3fe6080604052600436106101665760003560e01c8063a3653384116100d1578063df38a56a1161008a578063e6fd48bc11610064578063e6fd48bc146106de578063ee10c87214610709578063f63bc0021461074e578063f83d08ba1461077957610166565b8063df38a56a14610645578063e38d2ec714610670578063e3ac83da146106b157610166565b8063a36533841461044c578063ac01495e14610477578063ba67b51314610507578063bb1bbc94146105c2578063cd45c958146105ed578063cf3090121461061857610166565b80637150d8ae116101235780637150d8ae1461031a5780637a67b4791461035b57806380e9071b146103885780638534cb24146103b55780638da5cb5b146103e057806391db3da51461042157610166565b80630941dfb31461016b5780631df4ccfc146101b057806327cc777f146101db578063482ada561461021c5780634e71d92d1461025d57806361eb636d1461028a575b600080fd5b34801561017757600080fd5b506101ae6004803603604081101561018e57600080fd5b8101908080359060200190929190803590602001909291905050506107a6565b005b3480156101bc57600080fd5b506101c5610a47565b6040518082815260200191505060405180910390f35b3480156101e757600080fd5b506101f0610a4d565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561022857600080fd5b50610231610a73565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561026957600080fd5b50610272610a99565b60405180821515815260200191505060405180910390f35b34801561029657600080fd5b5061029f610c7a565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156102df5780820151818401526020810190506102c4565b50505050905090810190601f16801561030c5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561032657600080fd5b5061032f610d18565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561036757600080fd5b50610370610d3e565b60405180821515815260200191505060405180910390f35b34801561039457600080fd5b5061039d611390565b60405180821515815260200191505060405180910390f35b3480156103c157600080fd5b506103ca6118d0565b6040518082815260200191505060405180910390f35b3480156103ec57600080fd5b506103f56118d6565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561042d57600080fd5b506104366118fc565b6040518082815260200191505060405180910390f35b34801561045857600080fd5b50610461611902565b6040518082815260200191505060405180910390f35b34801561048357600080fd5b5061048c611908565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156104cc5780820151818401526020810190506104b1565b50505050905090810190601f1680156104f95780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6105c06004803603602081101561051d57600080fd5b810190808035906020019064010000000081111561053a57600080fd5b82018360208201111561054c57600080fd5b8035906020019184600183028401116401000000008311171561056e57600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f8201169050808301925050505050505091929192905050506119a6565b005b3480156105ce57600080fd5b506105d7612044565b6040518082815260200191505060405180910390f35b3480156105f957600080fd5b5061060261204a565b6040518082815260200191505060405180910390f35b34801561062457600080fd5b5061062d612050565b60405180821515815260200191505060405180910390f35b34801561065157600080fd5b5061065a612063565b6040518082815260200191505060405180910390f35b34801561067c57600080fd5b50610685612069565b604051808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b3480156106bd57600080fd5b506106c661208f565b60405180821515815260200191505060405180910390f35b3480156106ea57600080fd5b506106f36123bb565b6040518082815260200191505060405180910390f35b34801561071557600080fd5b5061074c6004803603604081101561072c57600080fd5b8101908080359060200190929190803590602001909291905050506123c1565b005b34801561075a57600080fd5b50610763612bf3565b6040518082815260200191505060405180910390f35b34801561078557600080fd5b5061078e612bf9565b60405180821515815260200191505060405180910390f35b816005600082815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461085e576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401808060200182810382526028815260200180614b486028913960400191505060405180910390fd5b6005600082815260200190815260200160002060006101000a81549073ffffffffffffffffffffffffffffffffffffffff0219169055807f7cc135e0cebb02c3480ae5d74d377283180a2601f8f644edf7987b009316c63a60405160405180910390a2730bda538d535bba5ae7bf22b9e231c42ce99d9667639201de55836040518263ffffffff1660e01b81526004018082815260200191505060006040518083038186803b15801561091057600080fd5b505af4158015610924573d6000803e3d6000fd5b505050506040513d6000823e3d601f19601f82011682018060405250602081101561094e57600080fd5b810190808051604051939291908464010000000082111561096e57600080fd5b8382019150602082018581111561098457600080fd5b82518660018202830111640100000000821117156109a157600080fd5b8083526020830192505050908051906020019080838360005b838110156109d55780820151818401526020810190506109ba565b50505050905090810190601f168015610a025780820380516001836020036101000a031916815260200191505b50604052505050600760008581526020019081526020016000209080519060200190610a2f929190614430565b50600b60008154809291906001019190505550505050565b601b5481565b600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b601860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600080429050601360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610b45576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252602b815260200180614b70602b913960400191505060405180910390fd5b601c60009054906101000a900460ff16610baa576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260228152602001806149c36022913960400191505060405180910390fd5b600c62093a80601254830381610bbc57fe5b0411610c13576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260338152602001806148036033913960400191505060405180910390fd5b7fbcb472984264b16baa8cde752f2af002ea8ce06f35d81caee36625234edd2a4660405160405180910390a1601360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b60098054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610d105780601f10610ce557610100808354040283529160200191610d10565b820191906000526020600020905b815481529060010190602001808311610cf357829003601f168201915b505050505081565b601460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600080429050601360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610dea576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260228152602001806147e16022913960400191505060405180910390fd5b601c60009054906101000a900460ff1615610e6d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601c8152602001807f43616e6e6f74206b69636b206c6f636b656420636f6e74726163742e0000000081525060200191505060405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff16601460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161415610f32576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260118152602001807f4e6f20627579657220746f206b69636b2e00000000000000000000000000000081525060200191505060405180910390fd5b62026ac0601254820310610f91576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252604c815260200180614a2a604c913960600191505060405180910390fd5b6000730bda538d535bba5ae7bf22b9e231c42ce99d9667634ac1ad78836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b158015610fe257600080fd5b505af4158015610ff6573d6000803e3d6000fd5b505050506040513d602081101561100c57600080fd5b8101908080519060200190929190505050148061114757506001730bda538d535bba5ae7bf22b9e231c42ce99d9667634ac1ad78836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b15801561107557600080fd5b505af4158015611089573d6000803e3d6000fd5b505050506040513d602081101561109f57600080fd5b81019080805190602001909291905050501480156111465750600e730bda538d535bba5ae7bf22b9e231c42ce99d9667633e239e1a836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b15801561110957600080fd5b505af415801561111d573d6000803e3d6000fd5b505050506040513d602081101561113357600080fd5b8101908080519060200190929190505050105b5b61119c576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260528152602001806145d36052913960600191505060405180910390fd5b601460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc479081150290604051600060405180830381858888f19350505050158015611204573d6000803e3d6000fd5b506000471461125e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252602b815260200180614836602b913960400191505060405180910390fd5b7fa9cc95a8903112deb977e7d46d0301afe843f1f9516bcf7b6eac3e69fdf80ea2600a604051808060200182810382528381815460018160011615610100020316600290048152602001915080546001816001161561010002031660029004801561130a5780601f106112df5761010080835404028352916020019161130a565b820191906000526020600020905b8154815290600101906020018083116112ed57829003601f168201915b50509250505060405180910390a16000601460006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060405180602001604052806000815250600a908051906020019061137f929190614430565b506000601281905550600191505090565b600080429050601460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461143c576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401808060200182810382526028815260200180614b9b6028913960400191505060405180910390fd5b601c60009054906101000a900460ff16156114bf576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601e8152602001807f43616e6e6f74207265636c61696d206c6f636b656420636f6e7472616374000081525060200191505060405180910390fd5b6001730bda538d535bba5ae7bf22b9e231c42ce99d9667634ac1ad78836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b15801561151057600080fd5b505af4158015611524573d6000803e3d6000fd5b505050506040513d602081101561153a57600080fd5b81019080805190602001909291905050501480156115e25750600e730bda538d535bba5ae7bf22b9e231c42ce99d9667633e239e1a836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b1580156115a457600080fd5b505af41580156115b8573d6000803e3d6000fd5b505050506040513d60208110156115ce57600080fd5b810190808051906020019092919050505010155b806115f357506202a3006012548203115b8061168757506002730bda538d535bba5ae7bf22b9e231c42ce99d9667634ac1ad78836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b15801561164a57600080fd5b505af415801561165e573d6000803e3d6000fd5b505050506040513d602081101561167457600080fd5b8101908080519060200190929190505050145b6116dc576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260298152602001806149536029913960400191505060405180910390fd5b601460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc479081150290604051600060405180830381858888f19350505050158015611744573d6000803e3d6000fd5b506000471461179e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252602b815260200180614836602b913960400191505060405180910390fd5b7fa9cc95a8903112deb977e7d46d0301afe843f1f9516bcf7b6eac3e69fdf80ea2600a604051808060200182810382528381815460018160011615610100020316600290048152602001915080546001816001161561010002031660029004801561184a5780601f1061181f5761010080835404028352916020019161184a565b820191906000526020600020905b81548152906001019060200180831161182d57829003601f168201915b50509250505060405180910390a16000601460006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060405180602001604052806000815250600a90805190602001906118bf929190614430565b506000601281905550600191505090565b601a5481565b601360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b601e5481565b60175481565b600a8054600181600116156101000203166002900480601f01602080910402602001604051908101604052809291908181526020018280546001816001161561010002031660029004801561199e5780601f106119735761010080835404028352916020019161199e565b820191906000526020600020905b81548152906001019060200180831161198157829003601f168201915b505050505081565b6000429050601360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415611a52576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260308152602001806148616030913960400191505060405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff16601460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614611b16576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601b8152602001807f436f6e747261637420616c7265616479206861732062757965722e000000000081525060200191505060405180910390fd5b601e54341015611b71576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252602881526020018061464d6028913960400191505060405180910390fd5b601c60009054906101000a900460ff1615611bd7576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260328152602001806148f66032913960400191505060405180910390fd5b600082511415611c32576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260288152602001806145ab6028913960400191505060405180910390fd5b6000600a80546001816001161561010002031660029004905014611ca1576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252602b815260200180614928602b913960400191505060405180910390fd5b6006730bda538d535bba5ae7bf22b9e231c42ce99d9667634ac1ad78836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b158015611cf257600080fd5b505af4158015611d06573d6000803e3d6000fd5b505050506040513d6020811015611d1c57600080fd5b8101908080519060200190929190505050148015611dc357506011730bda538d535bba5ae7bf22b9e231c42ce99d9667633e239e1a836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b158015611d8657600080fd5b505af4158015611d9a573d6000803e3d6000fd5b505050506040513d6020811015611db057600080fd5b8101908080519060200190929190505050115b80611e5757506000730bda538d535bba5ae7bf22b9e231c42ce99d9667634ac1ad78836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b158015611e1a57600080fd5b505af4158015611e2e573d6000803e3d6000fd5b505050506040513d6020811015611e4457600080fd5b8101908080519060200190929190505050145b611eac576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401808060200182810382526055815260200180614a766055913960600191505060405180910390fd5b33601460006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555081600a9080519060200190611f03929190614430565b5080601281905550600860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc60644781611f5157fe5b049081150290604051600060405180830381858888f19350505050158015611f7d573d6000803e3d6000fd5b507f608e57d52d59229eb27eb28e93e418ea49ade1e3d536dc1bb0331eba63109784600a3460405180806020018381526020018281038252848181546001816001161561010002031660029004815260200191508054600181600116156101000203166002900480156120315780601f1061200657610100808354040283529160200191612031565b820191906000526020600020905b81548152906001019060200180831161201457829003601f168201915b5050935050505060405180910390a15050565b601f5481565b601d5481565b601c60009054906101000a900460ff1681565b60195481565b601560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b600080429050601460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461213b576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260248152602001806147bd6024913960400191505060405180910390fd5b601c60009054906101000a900460ff166121a0576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260248152602001806148d26024913960400191505060405180910390fd5b6005730bda538d535bba5ae7bf22b9e231c42ce99d9667634ac1ad78836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b1580156121f157600080fd5b505af4158015612205573d6000803e3d6000fd5b505050506040513d602081101561221b57600080fd5b8101908080519060200190929190505050148061235657506006730bda538d535bba5ae7bf22b9e231c42ce99d9667634ac1ad78836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b15801561228457600080fd5b505af4158015612298573d6000803e3d6000fd5b505050506040513d60208110156122ae57600080fd5b810190808051906020019092919050505014801561235557506012730bda538d535bba5ae7bf22b9e231c42ce99d9667633e239e1a836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b15801561231857600080fd5b505af415801561232c573d6000803e3d6000fd5b505050506040513d602081101561234257600080fd5b8101908080519060200190929190505050105b5b6123ab576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252606081526020018061471f6060913960600191505060405180910390fd5b6123b3613210565b600191505090565b60125481565b816005600082815260200190815260200160002060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614612479576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401808060200182810382526028815260200180614b486028913960400191505060405180910390fd5b6005600082815260200190815260200160002060006101000a81549073ffffffffffffffffffffffffffffffffffffffff0219169055807f7cc135e0cebb02c3480ae5d74d377283180a2601f8f644edf7987b009316c63a60405160405180910390a28160066000858152602001908152602001600020819055506003600b541015801561256457506001600760006010548152602001908152602001600020805460018160011615610100020316600290049050108061256357506001600760006011548152602001908152602001600020805460018160011615610100020316600290049050105b5b15612578576125736001613447565b612bee565b6003600b54141561267c576126716009604051602001808061497c60479139604701828054600181600116156101000203166002900480156125f15780601f106125cf5761010080835404028352918201916125f1565b820191906000526020600020905b8154815290600101906020018083116125dd575b5050807f22297b746f74616c5374616b657d7d0000000000000000000000000000000000815250600f019150506040516020818303038152906040526040518060400160405280601d81526020017f646174612e76325573657250726f66696c652e746f74616c5374616b65000000815250670de0b6b3a7640000613745565b600f81905550612bdb565b6004600b54141561291d57612912730bda538d535bba5ae7bf22b9e231c42ce99d966763fc966d4560066000600c548152602001908152602001600020546040518263ffffffff1660e01b81526004018082815260200191505060006040518083038186803b1580156126ee57600080fd5b505af4158015612702573d6000803e3d6000fd5b505050506040513d6000823e3d601f19601f82011682018060405250602081101561272c57600080fd5b810190808051604051939291908464010000000082111561274c57600080fd5b8382019150602082018581111561276257600080fd5b825186600182028301116401000000008211171561277f57600080fd5b8083526020830192505050908051906020019080838360005b838110156127b3578082015181840152602081019050612798565b50505050905090810190601f1680156127e05780820380516001836020036101000a031916815260200191505b50604052505050600a60405160200180806145556056913960560183805190602001908083835b6020831061282a5780518252602082019150602081019050602083039250612807565b6001836020036101000a038019825116818451168082178552505050505050905001807f2c757365726e616d653a22000000000000000000000000000000000000000000815250600b01828054600181600116156101000203166002900480156128cb5780601f106128a95761010080835404028352918201916128cb565b820191906000526020600020905b8154815290600101906020018083116128b7575b50508061462560289139602801925050506040516020818303038152906040526040518060800160405280604581526020016149e560459139670de0b6b3a7640000613745565b600d81905550612bda565b6005600b541415612bbe57612bb3730bda538d535bba5ae7bf22b9e231c42ce99d966763fc966d4560066000600c548152602001908152602001600020546040518263ffffffff1660e01b81526004018082815260200191505060006040518083038186803b15801561298f57600080fd5b505af41580156129a3573d6000803e3d6000fd5b505050506040513d6000823e3d601f19601f8201168201806040525060208110156129cd57600080fd5b81019080805160405193929190846401000000008211156129ed57600080fd5b83820191506020820185811115612a0357600080fd5b8251866001820283011164010000000082111715612a2057600080fd5b8083526020830192505050908051906020019080838360005b83811015612a54578082015181840152602081019050612a39565b50505050905090810190601f168015612a815780820380516001836020036101000a031916815260200191505b50604052505050600960405160200180806145556056913960560183805190602001908083835b60208310612acb5780518252602082019150602081019050602083039250612aa8565b6001836020036101000a038019825116818451168082178552505050505050905001807f2c757365726e616d653a22000000000000000000000000000000000000000000815250600b0182805460018160011615610100020316600290048015612b6c5780601f10612b4a576101008083540402835291820191612b6c565b820191906000526020600020905b815481529060010190602001808311612b58575b50508061462560289139602801925050506040516020818303038152906040526040518060800160405280604581526020016149e560459139670de0b6b3a7640000613745565b600e81905550612bd9565b6006600b541415612bd857612bd36000613447565b612bee565b5b5b5b600b600081548092919060010191905055505b505050565b60165481565b600080429050601360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614612cc2576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601d8152602001807f4f6e6c79206f776e65722063616e206c6f636b20636f6e74726163742e00000081525060200191505060405180910390fd5b601c60009054906101000a900460ff1615612d28576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252602c8152602001806146f3602c913960400191505060405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff16601460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161415612ded576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260118152602001807f4e6f20627579657220746f206c6f636b2e00000000000000000000000000000081525060200191505060405180910390fd5b6000600a8054600181600116156101000203166002900490501415612e7a576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252601a8152602001807f4e6f2062757965724d6f64656c4e616d6520746f206c6f636b2e00000000000081525060200191505060405180910390fd5b62026ac0601254820310612ed9576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260418152602001806148916041913960600191505060405180910390fd5b6000730bda538d535bba5ae7bf22b9e231c42ce99d9667634ac1ad78836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b158015612f2a57600080fd5b505af4158015612f3e573d6000803e3d6000fd5b505050506040513d6020811015612f5457600080fd5b8101908080519060200190929190505050148061308f57506001730bda538d535bba5ae7bf22b9e231c42ce99d9667634ac1ad78836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b158015612fbd57600080fd5b505af4158015612fd1573d6000803e3d6000fd5b505050506040513d6020811015612fe757600080fd5b810190808051906020019092919050505014801561308e5750600e730bda538d535bba5ae7bf22b9e231c42ce99d9667633e239e1a836040518263ffffffff1660e01b81526004018082815260200191505060206040518083038186803b15801561305157600080fd5b505af4158015613065573d6000803e3d6000fd5b505050506040513d602081101561307b57600080fd5b8101908080519060200190929190505050105b5b6130e4576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252604c815260200180614acb604c913960600191505060405180910390fd5b60006130ee61387c565b9050601b548173ffffffffffffffffffffffffffffffffffffffff166370a08231306040518263ffffffff1660e01b8152600401808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060206040518083038186803b15801561315a57600080fd5b505afa15801561316e573d6000803e3d6000fd5b505050506040513d602081101561318457600080fd5b810190808051906020019092919050505010156131ec576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040180806020018281038252605b815260200180614698605b913960600191505060405180910390fd5b6001601c60006101000a81548160ff02191690831515021790555060019250505090565b6132696040518060600160405280603e815260200161477f603e91396040518060400160405280601481526020017f646174612e726f756e64732e302e6e756d6265720000000000000000000000008152506001613745565b600c8190555061335460096040516020018080614bc360409139604001828054600181600116156101000203166002900480156132dd5780601f106132bb5761010080835404028352918201916132dd565b820191906000526020600020905b8154815290600101906020018083116132c9575b5050807f22297b636f6e74726f6c7d7d0000000000000000000000000000000000000000815250600c019150506040516020818303038152906040526040518060400160405280601a81526020017f646174612e76325573657250726f66696c652e636f6e74726f6c0000000000008152506138a6565b60108190555061343f600a6040516020018080614bc360409139604001828054600181600116156101000203166002900480156133c85780601f106133a65761010080835404028352918201916133c8565b820191906000526020600020905b8154815290600101906020018083116133b4575b5050807f22297b636f6e74726f6c7d7d0000000000000000000000000000000000000000815250600c019150506040516020818303038152906040526040518060400160405280601a81526020017f646174612e76325573657250726f66696c652e636f6e74726f6c0000000000008152506138a6565b601181905550565b6000600b81905550600042905081613504576000601f5460066000600f5481526020019081526020016000205410806134aa575060066000600d5481526020019081526020016000205460066000600e5481526020019081526020016000205414155b905080613502576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401808060200182810382526031815260200180614b176031913960400191505060405180910390fd5b505b600061350e61387c565b90508073ffffffffffffffffffffffffffffffffffffffff1663a9059cbb601360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff168373ffffffffffffffffffffffffffffffffffffffff166370a08231306040518263ffffffff1660e01b8152600401808273ffffffffffffffffffffffffffffffffffffffff16815260200191505060206040518083038186803b1580156135b657600080fd5b505afa1580156135ca573d6000803e3d6000fd5b505050506040513d60208110156135e057600080fd5b81019080805190602001909291905050506040518363ffffffff1660e01b8152600401808373ffffffffffffffffffffffffffffffffffffffff16815260200182815260200192505050602060405180830381600087803b15801561364457600080fd5b505af1158015613658573d6000803e3d6000fd5b505050506040513d602081101561366e57600080fd5b8101908080519060200190929190505050506000600c478161368c57fe5b0462093a8060125485038161369d57fe5b04029050601360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050158015613709573d6000803e3d6000fd5b50601460009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b600061374f6144b0565b6137636019543063ee10c87260e01b613992565b90506137af6040518060400160405280600581526020017f74696d657300000000000000000000000000000000000000000000000000000081525084836139c39092919063ffffffff16565b6137f96040518060400160405280600381526020017f676574000000000000000000000000000000000000000000000000000000000081525086836139f69092919063ffffffff16565b6138436040518060400160405280600481526020017f706174680000000000000000000000000000000000000000000000000000000081525085836139f69092919063ffffffff16565b613872601860009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1682601a54613a29565b9150509392505050565b6000600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b60006138b06144b0565b6138c460165430630941dfb360e01b613992565b90506139106040518060400160405280600381526020017f676574000000000000000000000000000000000000000000000000000000000081525085836139f69092919063ffffffff16565b61395a6040518060400160405280600481526020017f706174680000000000000000000000000000000000000000000000000000000081525084836139f69092919063ffffffff16565b613989601560009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1682601754613a29565b91505092915050565b61399a6144b0565b6139a26144b0565b6139b985858584613cb2909392919063ffffffff16565b9150509392505050565b6139da828460800151613d6290919063ffffffff16565b6139f1818460800151613d8790919063ffffffff16565b505050565b613a0d828460800151613d6290919063ffffffff16565b613a24818460800151613d6290919063ffffffff16565b505050565b600030600454604051602001808373ffffffffffffffffffffffffffffffffffffffff1660601b815260140182815260200192505050604051602081830303815290604052805190602001209050600454836060018181525050836005600083815260200190815260200160002060006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550807fb5e6e01e79f91267dc17b4e6314d5d4d03593d2ceee0fbb452b750bd70ea5af960405160405180910390a2600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16634000aea08584613b4b87613e2b565b6040518463ffffffff1660e01b8152600401808473ffffffffffffffffffffffffffffffffffffffff16815260200183815260200180602001828103825283818151815260200191508051906020019080838360005b83811015613bbc578082015181840152602081019050613ba1565b50505050905090810190601f168015613be95780820380516001836020036101000a031916815260200191505b50945050505050602060405180830381600087803b158015613c0a57600080fd5b505af1158015613c1e573d6000803e3d6000fd5b505050506040513d6020811015613c3457600080fd5b8101908080519060200190929190505050613c9a576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004018080602001828103825260238152602001806146756023913960400191505060405180910390fd5b60016004600082825401925050819055509392505050565b613cba6144b0565b613cca8560800151610100613fac565b508385600001818152505082856020019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff16815250508185604001907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191690817bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191681525050849050949350505050565b613d6f8260038351614000565b613d82818361414590919063ffffffff16565b505050565b7fffffffffffffffffffffffffffffffffffffffffffffffff0000000000000000811215613dbe57613db98282614167565b613e27565b67ffffffffffffffff811315613ddd57613dd882826141d5565b613e26565b60008112613df657613df182600083614000565b613e25565b613e24826001837fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff03614000565b5b5b5b5050565b6060634042994660e01b60008084600001518560200151866040015187606001516001896080015160000151604051602401808973ffffffffffffffffffffffffffffffffffffffff1681526020018881526020018781526020018673ffffffffffffffffffffffffffffffffffffffff168152602001857bffffffffffffffffffffffffffffffffffffffffffffffffffffffff1916815260200184815260200183815260200180602001828103825283818151815260200191508051906020019080838360005b83811015613f0f578082015181840152602081019050613ef4565b50505050905090810190601f168015613f3c5780820380516001836020036101000a031916815260200191505b509950505050505050505050604051602081830303815290604052907bffffffffffffffffffffffffffffffffffffffffffffffffffffffff19166020820180517bffffffffffffffffffffffffffffffffffffffffffffffffffffffff83818316178352505050509050919050565b613fb461451d565b600060208381613fc057fe5b0614613fd95760208281613fd057fe5b06602003820191505b81836020018181525050604051808452600081528281016020016040525082905092915050565b6017811161402d576140278160058460ff16901b60ff16178461422190919063ffffffff16565b50614140565b60ff811161406f57614052601860058460ff16901b178461422190919063ffffffff16565b50614069816001856142419092919063ffffffff16565b5061413f565b61ffff81116140b257614095601960058460ff16901b178461422190919063ffffffff16565b506140ac816002856142419092919063ffffffff16565b5061413e565b63ffffffff81116140f7576140da601a60058460ff16901b178461422190919063ffffffff16565b506140f1816004856142419092919063ffffffff16565b5061413d565b67ffffffffffffffff811161413c57614123601b60058460ff16901b178461422190919063ffffffff16565b5061413a816008856142419092919063ffffffff16565b505b5b5b5b5b505050565b61414d61451d565b61415f83846000015151848551614263565b905092915050565b61418560036005600660ff16901b178361422190919063ffffffff16565b506141d182827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff036040516020018082815260200191505060405160208183030381529060405261431c565b5050565b6141f360026005600660ff16901b178361422190919063ffffffff16565b5061421d82826040516020018082815260200191505060405160208183030381529060405261431c565b5050565b61422961451d565b6142398384600001515184614341565b905092915050565b61424961451d565b61425a84856000015151858561438f565b90509392505050565b61426b61451d565b825182111561427957600080fd5b846020015182850111156142a4576142a385600261429d88602001518887016143f0565b0261440c565b5b6000808651805187602083010193508088870111156142c35787860182525b60208701925050505b602084106142ef57805182526020820191506020810190506020840393506142cc565b60006001856020036101000a03905080198251168184511681811785525050879350505050949350505050565b6143298260028351614000565b61433c818361414590919063ffffffff16565b505050565b61434961451d565b836020015183106143665761436584600286602001510261440c565b5b8351805160208583010184815381861415614382576001820183525b5050508390509392505050565b61439761451d565b846020015184830111156143b5576143b48560028685010261440c565b5b60006001836101000a03905085518386820101858319825116178152815185880111156143e25784870182525b505085915050949350505050565b60008183111561440257829050614406565b8190505b92915050565b60608260000151905061441f8383613fac565b5061442a8382614145565b50505050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061447157805160ff191683800117855561449f565b8280016001018555821561449f579182015b8281111561449e578251825591602001919060010190614483565b5b5090506144ac9190614537565b5090565b6040518060a0016040528060008019168152602001600073ffffffffffffffffffffffffffffffffffffffff16815260200160007bffffffffffffffffffffffffffffffffffffffffffffffffffffffff191681526020016000815260200161451761451d565b81525090565b604051806040016040528060608152602001600081525090565b5b80821115614550576000816000905550600101614538565b509056fe68747470733a2f2f6170692d746f75726e616d656e742e6e756d65722e61692f6772617068716c3f71756572793d7b726f756e645375626d697373696f6e506572666f726d616e636528726f756e644e756d6265723a4d6f64656c206e616d65206d757374206e6f7420626520656d70792f4e554c4c20737472696e672e436f6e74726163742062757965722063616e206f6e6c79206265206b69636b656420696e206265747765656e2053756e6461792030303a30302055544320616e64204d6f6e6461792031343a30302055544322297b726f756e644461696c79506572666f726d616e6365737b636f7272656c6174696f6e7d7d7d496e73756666696369656e74204554482073656e7420746f20656e74657220636f6e74726163742e756e61626c6520746f207472616e73666572416e6443616c6c20746f206f7261636c65436f6e747261637420726571756972657320302e35204c494e4b20746f74616c20746f206f706572617465206f6e6365206c6f636b65642c2063757272656e74204c494e4b2062616c616e636520697320756e64657220302e352e43616e6e6f74206c6f636b20636f6e7472616374207468617420697320616c7265616479206c6f636b65642e436f6e7472616374207265776172642063616e206f6e6c792062652076616c69646174656420616e6420636c61696d6564206f6e204672696461792c205361747572646179285361747572646179206265666f72652031383a3030205554432968747470733a2f2f6170692d746f75726e616d656e742e6e756d65722e61692f6772617068716c3f71756572793d7b726f756e64737b6e756d6265727d7d4f6e6c79207468652062757965722063616e207472696767657220616e2061756469742e4f6e6c79206f776e65722063616e206b69636b2066726f6d20636f6e74726163742e43616e6e6f7420636c61696d20636f6e7472616374206265666f7265203132207765656b73206861766520656c61707365642e4661696c656420746f2072657475726e2045544820746f2062757965722e2043616e6e6f74206b69636b2e4461746120736369656e746973742063616e206e6f7420656e746572207468656972206f776e20636f6e74726163742e43616e6e6f74206c6f636b20636f6e747261637420746861742077617320656e7465726564206279206275796572206f76657220343420686f7572732061676f2e43616e6e6f7420636f6e7465737420616e20756e6c6f636b656420636f6e74726163742e43616e6e6f742072656769737465722062757965724d6f64656c4e616d65206f6e206c6f636b656420636f6e74726163742e4d6f64656c206d757374206e6f7420616c726561647920686176652062757965724d6f64656c4e616d652e43616e206f6e6c79207265636c61696d2061667465722073656c6c6572206c6f636b20706572696f6468747470733a2f2f6170692d746f75726e616d656e742e6e756d65722e61692f6772617068716c3f71756572793d7b76325573657250726f66696c6528757365726e616d653a2243616e6e6f7420636c61696d20616e20756e6c6f636b656420636f6e74726163742e646174612e726f756e645375626d697373696f6e506572666f726d616e63652e726f756e644461696c79506572666f726d616e6365732e2d312e636f7272656c6174696f6e43616e6e6f74206b69636b2062757965722066726f6d20636f6e747261637420746861742077617320656e7465726564206279206275796572206f76657220343420686f7572732061676f2e436f6e74726163742063616e206f6e6c7920626520656e7465726564206279206275796572206265747765656e2053617475726461792031383a30302055544320616e642053756e6461792032343a303020555443436f6e74726163742063616e206f6e6c79206265206c6f636b656420696e206265747765656e2053756e6461792030303a30302055544320616e64204d6f6e6461792031343a30302055544353656c6c6572206d7573742068617665206661696c656420636f6e747261637420636865636b20746f2063616e63656c2e536f75726365206d75737420626520746865206f7261636c65206f662074686520726571756573744f6e6c7920746865206f776e65722063616e20747269676765722061207061796d656e7420636c61696d2e4f6e6c792062757965722063616e207265636c61696d20756e6c6f636b656420636f6e747261637468747470733a2f2f6170692d746f75726e616d656e742e6e756d65722e61692f3f71756572793d7b76325573657250726f66696c6528757365726e616d653a22a26469706673582212200a13a56cb806dc4efc8bee4ff7b80b13161f6de0af84a365b0437d5154bb51fd64736f6c634300060c00334461746120736369656e74697374206d757374207374616b652061746c6561737420302e3031204e4d5220666f7220766572696669636174696f6e20707572706f736573';
const abi = JSON.parse('[{"inputs":[{"internalType":"string","name":"_sellerModelName","type":"string"},{"internalType":"uint256","name":"_costETH","type":"uint256"},{"internalType":"uint256","name":"_sellerStakePromise","type":"uint256"}],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"","type":"string"},{"indexed":false,"internalType":"uint256","name":"","type":"uint256"}],"name":"BuyerModelNameRegistered","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"id","type":"bytes32"}],"name":"ChainlinkCancelled","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"id","type":"bytes32"}],"name":"ChainlinkFulfilled","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"bytes32","name":"id","type":"bytes32"}],"name":"ChainlinkRequested","type":"event"},{"anonymous":false,"inputs":[],"name":"Claimed","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"","type":"string"},{"indexed":false,"internalType":"uint256","name":"","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"","type":"uint256"}],"name":"Constructed","type":"event"},{"anonymous":false,"inputs":[],"name":"Contested","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"","type":"string"}],"name":"Kicked","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"string","name":"","type":"string"},{"indexed":false,"internalType":"string","name":"","type":"string"}],"name":"Locked","type":"event"},{"inputs":[],"name":"bensch","outputs":[{"internalType":"address payable","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"birthStamp","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"buyer","outputs":[{"internalType":"address payable","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"buyerModelName","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"claim","outputs":[{"internalType":"bool","name":"success","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"contest","outputs":[{"internalType":"bool","name":"success","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"costETH","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"feeBytes32","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"feeInt","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"bytes32","name":"_requestId","type":"bytes32"},{"internalType":"bytes32","name":"_APIresult","type":"bytes32"}],"name":"fulfillBytes32","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes32","name":"_requestId","type":"bytes32"},{"internalType":"int256","name":"_APIresult","type":"int256"}],"name":"fulfillInt","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"jobIdBytes32","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"jobIdInt","outputs":[{"internalType":"bytes32","name":"","type":"bytes32"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"kick","outputs":[{"internalType":"bool","name":"success","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"lock","outputs":[{"internalType":"bool","name":"success","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"locked","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"oracleBytes32","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"oracleInt","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address payable","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"reclaim","outputs":[{"internalType":"bool","name":"success","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"string","name":"_buyerModelName","type":"string"}],"name":"registerBuyerModelName","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"sellerModelName","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"sellerStakePromise","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"startTimestamp","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"}]');

function modalPrimary() {
    modalDecision = true;
    console.log(modalDecision);
    $('#gasEstimationFailedModal').modal('toggle');
}

function modalSecondary() {
    modalDecision = false;
    console.log(modalDecision);
    $('#gasEstimationFailedModal').modal('toggle');
}

function setup() {
    console.log("SETUP");
    console.log(window.ethereum);
    if (window.ethereum) {

        console.log("E");
        window.ethereum.enable();

        web3 = new Web3(window.ethereum);
        console.log(web3.eth.accounts.length);
        console.log("A");
        console.log(web3);
        if (!web3) {
            console.log("NW3");
            $('#metaMaskRequiredModal').modal('toggle');
            return;
        }

        console.log("IF REACHED");
        console.log(web3.eth.accounts[0]);
        console.log(account);
        if (web3.eth.accounts[0] !== account) {
            console.log("IF REACHED2");
            console.log("F");
            web3.eth.getAccounts(function(err, accounts) {
                if (err != null) {
                    console.log("D2");
                    //alert("Error retrieving accounts.");
                    $('#metaMaskRequiredModal').modal();
                    return;

                }
                if (accounts.length == 0) {
                    console.log("D");
                    $('#metaMaskRequiredModal').modal();
                    return;
                }

                account = accounts[0];

                console.log('Account: ' + account);
                web3.eth.defaultAccount = account;
            });

        } else {
            console.log("IF12 REACHED");
        }


    } else {
        console.log("IF3 REACHED");
        console.log("No metamask");

        $('#metaMaskRequiredModal').modal('toggle');
        return;
    }


} //, 100);


function setUpCheck(viewB) {
    console.log(viewB);
    if (!web3) {
        console.log("not web3");
        $('#metaMaskRequiredModal').modal('toggle');
        return false;
    }
    if (window.ethereum) {
        console.log("wind eth");
        console.log("webeth");
    } else {
        console.log("not wind eth");
        $('#metaMaskRequiredModal').modal('toggle');
        return false;
    }
    if (!viewB && !contract) {

      console.log(viewB);
        console.log("not view not cont");
        $('#contractRequiredModal').modal('toggle');
        return false;
    }
    console.log("true ret");
    return true;
}

function retreiveContract() {

    console.log("true retA");
    if (!setUpCheck(true)) {
        return;
    }
    console.log("true retB");
    contractAddress = $("#newInfo").val().trim();
    contract = new web3.eth.Contract(abi, $("#newInfo").val().trim());
    console.log(contract);
    document.getElementById("addressLabel").innerHTML = "Contract Address: " + '<a target="_blank" href = "https://kovan.etherscan.io/address/' + $("#newInfo").val() + '">' + $("#newInfo").val().trim() + "</a>" + '<a data-container="body" data-toggle="tooltip" data-placement="top" title="Copy Shareable Steak View Link" style = "float:right;verical-algin:center"  onclick ="shareableLink()"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-link" viewBox="0 0 16 16"><path d="M6.354 5.5H4a3 3 0 0 0 0 6h3a3 3 0 0 0 2.83-4H9c-.086 0-.17.01-.25.031A2 2 0 0 1 7 10.5H4a2 2 0 1 1 0-4h1.535c.218-.376.495-.714.82-1z"/><path d="M9 5.5a3 3 0 0 0-2.83 4h1.098A2 2 0 0 1 9 6.5h3a2 2 0 1 1 0 4h-1.535a4.02 4.02 0 0 1-.82 1H12a3 3 0 1 0 0-6H9z"/></svg></a>';
    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
      });

    contract.methods.sellerModelName().call().then(function(info) {
        
        if(info.length > 0)
        {
            document.getElementById('sellerModelNameLabel').innerHTML = "Data Scientist Model Name: " + '<a target="_blank" href = "https://numer.ai/' + String(info) + '">' + String(info) + "</a>";
        }
        else
        {
            document.getElementById('sellerModelNameLabel').innerHTML = "Data Scientist Model Name: Not Determined";
        }
    });


    contract.methods.sellerModelName().call().then(function(info) {
        
        dSModelName = info;
        document.getElementById('sellerModelNameLabel').innerHTML = "Data Scientist Model Name: " + '<a target="_blank" href = "https://numer.ai/' + String(info) + '">' + String(info) + "</a>";
    });



    contract.methods.costETH().call().then(function(info) {
        

        document.getElementById('costETHLabel').innerHTML = "Contract Cost: " + (new BigNumber(info)).shiftedBy(-18).toString() + " ETH";
        //document.getElementById('costETHLabel').className = document.getElementById('costETHLabel').className +  " text-success";
    });
    contract.methods.sellerStakePromise().call().then(function(info) {
        
        sStakePromise = (new BigNumber(info)).shiftedBy(-18).toString();
        document.getElementById('sellerStakePromiseLabel').innerHTML = "Promised Data Scientist Stake: " + (new BigNumber(info)).shiftedBy(-18).toString() + " NMR";
    });

    contract.methods.locked().call().then(function(info) {
        

        document.getElementById('lockedLabel').innerHTML = "Locked: " + String(info);
    });

    contract.methods.birthStamp().call().then(function(info) {
        
        var dateT = new Date(0);
        dateT.setUTCSeconds(info);
        document.getElementById('birthStampLabel').innerHTML = "Birth Date: " + String(dateT.toUTCString().replace("GMT","UTC"));
    });

    contract.methods.startTimestamp().call().then(function(info) {
        
        
        var dateT = new Date(0);

        infoBigNum = new BigNumber(info);

        infoEndBigNum =BigNumber.sum(infoBigNum,7257600);

        dateT.setUTCSeconds(infoBigNum.toString());
        dateTEnd = new Date(0);
        
        dateTEnd.setUTCSeconds(infoEndBigNum.toString());
        console.log(info, typeof info,"INFO TYPE");
        startDate = dateT;

        cEnd = infoEndBigNum.toString()
        if(info != 0 )
        {
         document.getElementById('startStampLabel').innerHTML = "Start Date: " + String(dateT.toUTCString().replace("GMT","UTC"));
         document.getElementById('endStampLabel').innerHTML = "End Date: " + String(dateTEnd.toUTCString().replace("GMT","UTC"));
        }
        else
        {
            document.getElementById('startStampLabel').innerHTML = "Start Date: Not Determined";
        }
    });

    contract.methods.buyerModelName().call().then(function(info) {
        
        if(info.length > 0)
        {
            document.getElementById('buyerModelNameLabel').innerHTML = "Buyer Model Name: " + '<a target="_blank" href = "https://numer.ai/' + String(info) + '">' + String(info) + "</a>";
            bModelName = info;
        }
        else
        {
            document.getElementById('buyerModelNameLabel').innerHTML = "Buyer Model Name: Not Determined";
            //Cause serverside API fail if no model name
            bModelName = "";
        }
    });
    console.log($("#newInfo").val().trim());
    if(!window.location.toString().includes("?"))
    {
        window.location +="?"+ $("#newInfo").val().trim();
    }


    /*contract.methods.payoutPending(1).call().then(function(info) {
        

            document.getElementById('sellerModelPendingPayoutLabel').innerHTML = "Seller Model Live Pending Payout: " + (new BigNumber(info)).shiftedBy(-18).toString();

    });*/


}

function sendWrapper(method, options) {
    console.log(options);
    txTemp = document.createElement("li");
    //{from: account, value: info }
    method.send(options, function(error, transactionHash) {

        txTemp.className = "list-group-item";
        txTemp.innerHTML = '<a target="_blank" href = "https://kovan.etherscan.io/tx/' + transactionHash + '">' + actionDesc + " " + String(new Date()) + "</a>";

        //alert(transactionHash);

    }).catch(function(e) {
        console.log(e.message);
        if (!(String(e.message) === String("MetaMask Tx Signature: User denied transaction signature."))) {
            document.getElementById("transactionLog").appendChild(txTemp);
        }
        return e;
    }).then(function(e) {
        console.log(e.message);
        if (!(String(e.message) === String("MetaMask Tx Signature: User denied transaction signature."))) {
            document.getElementById("transactionLog").appendChild(txTemp);
        }
    });
}

function gasEstimateCheckModalWrapper(method, runIfAlternate) {
     var caught = false;
    method.estimateGas().catch(function() {
        caught = true;
        $('#gasEstimationFailedModal').modal().on('hidden.bs.modal', function(e) {
            console.log("closed");
            if (!modalDecision) {
                runIfAlternate();

            }
            modalDecision = true;
        });

    }).then(
        
        function() {
          if(caught)
          {
            return;
          }
            runIfAlternate();
        }
    );
}



function registerBuyerName() {
    if (!setUpCheck(false)) {
        return;
    }

    actionDesc = "Register Buyer Name.";
    print(contract,"IMPORTANT CONTRACT");
    toTransact = contract.methods.registerBuyerModelName($("#buyerModelNameInput").val().trim());
    gasEstimateCheckModalWrapper(toTransact, function() {
        contract.methods.costETH().call().then(function(info) {
            sendWrapper(toTransact, {
                from: account,
                value: info
            }, actionDesc);



            //document.getElementById('costETHLabel').className = document.getElementById('costETHLabel').className +  " text-success";
        });

    });



}

function reclaim() {
    if (!setUpCheck(false)) {
        return;
    }
    actionDesc = "Reclaim.";
    toTransact = contract.methods.reclaim();
    gasEstimateCheckModalWrapper(toTransact, function() {
            sendWrapper(toTransact, {
                from: account
            }, actionDesc);
        }


    );
}

function contest() {
    if (!setUpCheck(false)) {
        return;
    }
    actionDesc = "Contest.";
    toTransact = contract.methods.contest();
    gasEstimateCheckModalWrapper(toTransact, function() {
            sendWrapper(toTransact, {
                from: account
            }, actionDesc);
        }


    );
}

function kick() {
    if (!setUpCheck(false)) {
        return;
    }
    actionDesc = "Kick.";
    toTransact = contract.methods.kick();
    gasEstimateCheckModalWrapper(toTransact, function() {
            sendWrapper(toTransact, {
                from: account
            }, actionDesc);
        }


    );
}

function lock() {
    if (!setUpCheck(false)) {
        return;
    }
    actionDesc = "Lock.";
    toTransact = contract.methods.lock();
    gasEstimateCheckModalWrapper(toTransact, function() {
            sendWrapper(toTransact, {
                from: account
            }, actionDesc);
        }


    );
}

function claim() {
    if (!setUpCheck(false)) {
        return;
    }
    console.log("contract");
    console.log(contract);
    console.log("account");
    console.log(account);
    actionDesc = "Claim.";
    toTransact = contract.methods.claim();
    gasEstimateCheckModalWrapper(toTransact, function() {
            sendWrapper(toTransact, {
                from: account
            }, actionDesc);
        }


    );
}

function deploy() {
    if (!setUpCheck(true)) {
        return;
    }
    txTemp = document.createElement("li");
    var bcr = bc;
    toDeploy = new web3.eth.Contract(abi, {
        from: account,
        data: bcr
    });
    dSMN = $("#dataScientistModelNameInput").val().trim();
    sP = new BigNumber($("#dataScientistStakePromiseInput").val().trim()).shiftedBy(18);
    cE = new BigNumber($("#costETHInput").val().trim()).shiftedBy(18);
    toDeploy.deploy({
        data: bcr,
        arguments: [dSMN, cE, sP]
    }).send({
        from: account
    }).then(

        function(newContractInstance) {

            txTemp = document.createElement("li");
            txTemp.className = "list-group-item";
            txTemp.innerHTML = '<a target="_blank" href = "https://kovan.etherscan.io/address/' + newContractInstance.options.address + '">' + "Deploy." + " " + String(new Date()) + "</a>";
            document.getElementById("transactionLog").appendChild(txTemp);
            $("#newInfo").val(newContractInstance.options.address);
            retreiveContract();
        }
    );
}

function highlightCalendarColumn(selectedCol)
{
    
    var allTd = document.getElementsByTagName("td");

    for(var i = 0;i < allTd.length;i++)
    {

                allTd[i].style = ""; 

    }
    allTd = document.getElementsByTagName("th");
    for(var i = 0;i < allTd.length;i++)
    {

                allTd[i].style = ""; 

    }

    allTd = document.getElementsByTagName("td");

    for(var i = 0;i < allTd.length;i++)
    {
        if(allTd[i].getAttribute("calendarColumn") !== null && allTd[i].getAttribute("calendarColumn").includes(selectedCol))
        {
            allTd[i].style = "border-style:solid;border-width:2px";
            if(allTd[i].getAttribute("calendarColumn").includes("nb"))
            {
                allTd[i].style = "border-style:solid;border-width:2px;border-bottom:none"; 
            }
        }
    }
    allTd = document.getElementsByTagName("th");
    for(var i = 0;i < allTd.length;i++)
    {
        if(allTd[i].getAttribute("calendarColumn") !== null && allTd[i].getAttribute("calendarColumn").includes(selectedCol))
        {
            allTd[i].style = "border-style:solid;border-width:2px";
            if(allTd[i].getAttribute("calendarColumn").includes("nb"))
            {
                allTd[i].style = "border-style:solid;border-width:2px;border-bottom:none"; 
            }
        }
    }
}

function shareableLink()
{
    
    navigator.clipboard.writeText(window.location.href.slice(0,window.location.href.lastIndexOf("/") + 1) + "?" + contractAddress);
}

function requestSubscribe()
{
    if(!contract)
    {
        $('#contractRequiredModal').modal('toggle')
    }
    else
    {
        window.location='http://bensch.pythonanywhere.com' + "/" + dSModelName + "," + bModelName + "," + sStakePromise + "," + cEnd + "," + document.getElementById("email").value+","+$("#newInfo").val().trim();
    }
    
}


window.addEventListener('load', () => {
    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
      });
    setup();
    //$("#metaMaskRequiredModal").on("hidden.bs.modal",setup);

    console.log("ABC",window.location.href.slice(window.location.href.indexOf("?")+1).length);
    if(window.location.href.slice(window.location.href.indexOf("?")+1).length > 0 && window.location.href.toString().includes("?"))
    {
        console.log("ABC",window.location.href.slice(window.location.href.indexOf("?")+1));
        document.getElementById("newInfo").value = (window.location.href.slice(window.location.href.indexOf("?")+1));
        retreiveContract();
    }

    var calendarInterval = setInterval(
    function()
    {
        var d = new Date();



        var n = d.toUTCString();
        console.log(n);
        document.getElementById("UTCclock").innerHTML = n.replace("GMT","UTC");
        if(startDate !== undefined && startDate.getTime() !== 0)
        {
            console.log("have startdate",startDate);
            console.log(startDate.getTime(),d.getTime());
            
            var elapsed = (d.getTime() - startDate.getTime())/3600000;

            //highlightCalendarColumn("" + (d.getDay() + 1))
            console.log("UTC DEB HOURS",typeof d.getUTCHours());
            if(elapsed > 198)
            {
                highlightCalendarColumn("9");
            }
            else
            {
                switch(d.getUTCDay())
            {
                case 0:
                    if(elapsed > 48)
                    {
                        highlightCalendarColumn("8");
                    }
                    else
                    {
                        highlightCalendarColumn("1");
                    }
                    break;

                case 1:
                    console.log("UTC HOURS",d.getUTCHours());
                     if(d.getUTCHours() <=13)
                    {
                        highlightCalendarColumn("2");
                    }
                    break;

                case 2:
                    highlightCalendarColumn("3");
                    break;

                case 3:
                    highlightCalendarColumn("4");
                    break;
                
                case 4:
                    highlightCalendarColumn("5");
                    break;

                case 5:
                    highlightCalendarColumn("6");
                    break;
                
                case 6:

                    if(elapsed > 48)
                    {
                        highlightCalendarColumn("7");
                    }
                    else
                    {

                        if(d.getUTCHours() >= 18)
                        {

                            highlightCalendarColumn("0");
                        }
                    }
                    break;
                


            }
            }
            


        }
    },500);


});
